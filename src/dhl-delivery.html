<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="barcode-scanner.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="hand-signature.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="fetch-element.html">

<dom-module id="dhl-delivery">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
                padding: 10px;
            }
            paper-button {
                margin-top: 5px;
            }
        </style>

        <dhl-xmlxhr
                url="/test/xml/replyLogon.xml"
                method="GET"
                body="[[logonBody]]"
                response="{{logonResp}}"
                ok-text="Aanmelden Gelukt"
                error-text="Aanmelden Mislukt">
        </dhl-xmlxhr>

        <dhl-xmlxhr
                url="/test/xml/replyOverviewTrips.xml"
                method="GET"
                body="[[timeframeBody]]"
                response="{{timeframeResp}}"
                ok-text="Ritten Opgehaald"
                error-text="Ritten Ophalen Mislukt">
        </dhl-xmlxhr>



        <div class="media">

            <barcode-scanner code="{{barcode}}"
                             placeholder-message="Scanner Activeren">
            </barcode-scanner>

            <paper-card class="card">
                <paper-input value="{{barcode}}"
                             label="PID"
                             required
                             auto-validate>
                </paper-input>

                <div>[[parcel.CUSTOMER_SHORT_NAME]]</div>
                <div>[[parcel.STREET]] [[parcel.HOUSE_NUMBER]]</div>
                <div>[[parcel.POSTAL_CODE_NUMERIC]][[parcel.POSTAL_CODE_ALPHA]] [[parcel.CITY]]</div>

                <p>Rembours: 25,00 Euro</p>

                <paper-input value="{{pin}}"
                             label="Pincode"
                             type="Number"
                             required
                             auto-validate>
                </paper-input>

                <div>Zet Hier Uw Handtekenning:</div>
                <hand-signature data="{{signature}}"
                                width="288px"
                                height="200px"></hand-signature>

                <paper-button raised>Op Adres</paper-button>
                <paper-button raised>Bij Buren (KIB)</paper-button>
                <paper-button raised>Niet Thuis (KIB)</paper-button>
                <paper-button raised>Overig</paper-button>

            </paper-card>

        </div>

        <audio id="audio" src="../images/censor-beep-01.mp3" preload="true"></audio>

    </template>

    <script>
        Polymer({
            is: 'dhl-delivery',

            properties:{

                barcode:{
                    type: String,
                    observer: 'processBarcode',
                    notify: true,
                },

                pieceInfo: {
                    type: Object,
                    value: function(){return {};},
                    notify:true,
                },

                signature: {
                    type: String,
                    observer: 'signatureChanged',
                }
            },

            processBarcode: function(barcode, oldValue) {
                if(!barcode) return;
                //beep
                this.$.audio.play();

                //update the status in tripInfo
                //this.set('tripInfo.stops.'+sIdx+'.pieces.'+pIdx+'.status', 'sending...');

            },

            signatureChanged: function (newValue, oldValue) {
                //console.log('signature', newValue);
                // The newValue contains the image data
            }
        });
    </script>
</dom-module>
