<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="dhl-xmlxhr.html">
<link rel="import" href="redux-store.html">

<dom-module id="dhl-post200">
    <template>

        <dhl-xmlxhr
                id="ajax"
                message-identifier="200"
                general-header-pda="{{generalHeaderPda}}"
                body="[[request]]"
                response="{{response}}"
                ok-text="Ritten Ophalen Gelukt"
                error-text="Ritten Ophalen Mislukt">
        </dhl-xmlxhr>


    </template>


    <script>
        Polymer({
            is: 'dhl-post200',

            behaviors: [ ReduxBehavior ],

            properties:{

                /**
                 * The request object sent to the server
                 */
                request: {
                    type: 'Object'
                },

                /**
                 * The logon response from the server in JSON format
                 */
                response: {
                    type: Object,
                    observer: 'responseChanged',
                },

                /**
                 * The general header to be used on all requests
                 */
                generalHeaderPda:{
                    type: Object,
                    value: function(){return{};},
                    statePath: 'generalHeaderPda',
                },

                /**
                 * The general header to be used on all requests
                 */
                logonSuccess:{
                    type: Object,
                    value: false,
                    statePath: 'logonSuccess',
                    observer: 'logonSuccessChanged',
                },

            },

            actions: {
                getTripsSuccess: function() {
                    return {
                        type: 'GET_TRIPS_SUCCESS'
                    };
                }
            },

            logonSuccessChanged: function(logonSuccess) {
                if(!logonSuccess) return;
                var request = {
                    Envelope:{
                        Header: null,
                        Body: {
                            TripsOverview: {}
                        }
                    }
                };
                this.$.ajax.body = request;
                this.$.ajax.generateRequest();
            },

            responseChanged: function(resp, oldValue) {
                if(!resp) return;
                //TODO Test for NOK

                debugger;

                return this.dispatch('getTripsSuccess');
            },

        });
    </script>
</dom-module>
