<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-styles/color.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">
<link rel="import" href="../bower_components/paper-time-input/paper-time-input.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="dhl-icons.html">

<!--
<link rel="import" href="../../iron-image/iron-image.html">
<link rel="import" href="../../paper-icon-button/paper-icon-button.html">
-->

<dom-module id="dhl-timeframe">
    <template>
        <style include="iron-flex iron-flex-alignment iron-positioning"></style>
        <style include="shared-styles">
            :host {
                display: block;
                @apply(--paper-font-common-base);
            }

            paper-button {
                height: 60px;
                margin-bottom: 5px;
            }
            .item {
                outline: none;
                cursor: pointer;
            }

            .timeframe {
                font-size: 18px;
                font-weight: bold;
            }
            .status {
                font-size: 16px;
                font-weight: bold;
                margin-left: 20px;
            }

            .tripnum{
                font-size: 16px;
            }

            .longText {
                font-size: 16px;
                display: none;
            }

            .item.expanded .longText {
                display: block;
            }

            .details{
                margin-bottom: 40px;
            }

            .leading {
                width: 30px;
            }

        </style>

        <dhl-xmlxhr
                url="/src/xml/301.xml"
                method="GET"
                body="[[body]]"
                response="{{resp301}}"
                ok-text="Rit Gestart"
                error-text="Rit Starten Mislukt">
        </dhl-xmlxhr>

        <div class="media">
            <div class="card">
                <template is="dom-repeat"
                          items="{{resp201.xml-fragment.REPLY_OVERVIEW_TRIPS}}"
                          as="trip">
                    <div class="timeframe">EVA: --:--</div> <!--[[timeframe.TIMEFRAME_DESCRIPTION]]-->
                    <div class="layout horizontal">
                        <div class="leading">[[index]]</div>
                        <!--<div class="leading">[[trip.TRIP_SEQUENCE_NUMBER]]</div>-->
                        <div class="details">
                            <div class="layout horizontal">
                                <div>Rit [[trip.TRIP_NUMBER]]</div>
                                <div class="status">[[trip.TRIP_PDA_STATUS_DESCRIPTION]]</div>
                                <div class="flex"></div>
                                <div>0/[[trip.NUMBER_IN_TRIP]]</div>
                            </div>
                            <div class="layout vertical">
                                <paper-time-input label="Eerste Verwachte Aankomst" format="24"></paper-time-input>
                                <paper-button
                                        on-tap=""
                                        trip="[[trip]]"
                                        raised>EVA invullen</paper-button>
                            </div>

                            <div class="layout horizontal">
                                <paper-input
                                        label="Start km"
                                        slot="suffix" suffix
                                        type="number"
                                        autoValidate
                                        mandatory>km</paper-input>
                                <paper-input
                                        label="Eind km"
                                        type="number"
                                        autoValidate
                                        mandatory
                                        type="number"
                                        disabled="true"></paper-input>
                                <paper-input
                                        label="Prive km"
                                        type="number"
                                        autoValidate
                                        mandatory
                                        type="number"
                                        disabled="true"></paper-input>
                            </div>
                            <div class="layout horizontal">
                                <paper-button
                                        on-tap="onStartTap"
                                        trip="[[trip]]"
                                        raised>
                                    <iron-icon icon="dhl-icons:starttrip"></iron-icon> Start Rit</paper-button>
                                <paper-button
                                        on-tap="onStartTap"
                                        trip="[[trip]]"
                                        raised
                                        disabled>
                                    <iron-icon icon="dhl-icons:endtrip"></iron-icon> Einde Rit</paper-button>
                            </div>
                        </div>
                    </div>
                </template>

            </div>
            <div class="card">
                <paper-button raised>Ververs data</paper-button>
                <paper-button raised>SPRET Aannemen</paper-button>
                <paper-button raised>Afhalen Parcel-shop / -Station</paper-button>
                <paper-button raised>Afgehandelde Opdracten</paper-button>
                <paper-button raised>Alle Opdrachten</paper-button>
            </div>
        </div>


<!--
        <iron-list id="list"
                   items="{{resp201.xml-fragment.REPLY_OVERVIEW_TIMEFRAME}}"
                   as="timeframe"
                   selection-enabled
                   multi-selection>
            <template>
                <div class="media">
                    <div class="card">
                        <div class$="[[getClassForItem(timeframe, selected)]]" tabindex$="[[tabIndex]]">
                            <div class="timeframe">[[timeframe.TIMEFRAME_DESCRIPTION]]</div>

                            <div class="longText">
                                <template is="dom-repeat"
                                          items="{{resp201.xml-fragment.REPLY_OVERVIEW_TRIPS}}"
                                          as="trip">
                                    <div class="details">
                                        <div class="layout horizontal">
                                            <!--<div class="leading">[[trip.TRIP_SEQUENCE_NUMBER]]</div>-- >
                                            <div class="leading">[[index]]</div>
                                            <div>Rit [[trip.TRIP_NUMBER]]</div>
                                            <div class="status">[[trip.TRIP_PDA_STATUS_DESCRIPTION]]</div>
                                            <div class="flex"></div>
                                            <div>0/[[trip.NUMBER_IN_TRIP]]</div>
                                        </div>
                                        <div class="layout horizontal">
                                            <div class="leading"></div>
                                            <paper-button
                                                on-tap="onPrepareTap"
                                                trip="[[trip]]"
                                                raised>Voorbereiden Overdracht</paper-button>
                                        </div>

                                        <div class="layout horizontal">
                                            <div class="leading"></div>
                                            <paper-input
                                                    label="Start km"
                                                    slot="suffix" suffix
                                                    type="number"
                                                    autoValidate
                                                    mandatory>km</paper-input>
                                            <paper-input
                                                    label="Eind km"
                                                    type="number"
                                                    autoValidate
                                                    mandatory
                                                    type="number"
                                                    disabled="true"></paper-input>
                                            <paper-input
                                                    label="Prive km"
                                                    type="number"
                                                    autoValidate
                                                    mandatory
                                                    type="number"
                                                    disabled="true"></paper-input>
                                        </div>
                                        <div class="layout horizontal">
                                            <div class="leading"></div>
                                            <paper-button
                                                on-tap="onStartTap"
                                                trip="[[trip]]"
                                                raised>
                                                <iron-icon icon="dhl-icons:starttrip"></iron-icon> Start Rit</paper-button>
                                            <paper-button
                                                on-tap="onStartTap"
                                                trip="[[trip]]"
                                                raised
                                                disabled>
                                                <iron-icon icon="dhl-icons:endtrip"></iron-icon> Einde Rit</paper-button>
                                        </div>

                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </iron-list>
-->
        <a id="prepareNav" href="/tripprepare" style="display:none;">In Rit</a>
        <a id="startNav" href="/tripexecute" style="display:none;">Start Rit</a>

    </template>

    <script>

        Polymer({
            is: 'dhl-timeframe',

            properties: {

                /**
                 * The resp101 object
                 */
                resp101:{
                    type: Object,
                },

                /**
                 * The resp301 object returned from the server
                 */
                resp301:{
                    type: Object,
                    observer: 'resp301Changed',
                    notify: true
                },

                /**
                 * The select trip id that results from this process
                 */
                selectedTripId:{
                    type: Object,
                    notify: true
                }

            },

            attached: function() {
                // Use the document element
                // this.$.list.scrollTarget = this.ownerDocument.documentElement;
            },

            getClassForItem: function(item, selected) {
                return selected ? 'item expanded' : 'item';
            },

            compare: function(val1, val2) {
                return val1 == val2;
            },

            computedIndex: function(index) {
                return index+1;
            },

            resp301Changed: function(resp, oldValue) {
                if(!resp) return;
                this.selectedTripId = this.tripKey;
                this.$.startNav.click();
            },

            onStartTap: function(event) {
                this.tripKey = event.target.trip.TRIP_KEY.toString();
                //send start trip to the server
                this.body = {
                    REQUEST_LOGON:{
                        GENERAL_HEADER_PDA:{
                            MESSAGE_IDENTIFIER: 300,
                            MESSAGE_TIMESTAMP: '',
                            IMEI_NUMBER: '',
                            TELEPHONE_NUMBER: '',
                            P_NUMBER: '',
                            PDA_SOFTWARE_VERSION: '',
                            PDA_MESSAGE_VERSION: '',
                            TRANSMISSION_ATTEMPT_NUMBER: '',
                            MESSAGE_SEQUENCE_SESSION_NUMBER: ''
                        }
                    }
                };
            },

            XonStartTap: function(event) {
                this.tripKey = event.target.trip.TRIP_KEY.toString();
                //send start trip to the server
                this.$.startNav.click();
            },

            onEndTap: function(event) {
                this.trip = event.target.trip;
                //send request to the server

            },

        });

    </script>
</dom-module>

